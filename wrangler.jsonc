{
  // =============================================================================
  // ParqueDB Cloudflare Worker Configuration
  // =============================================================================

  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "parquedb",
  "main": "src/worker/index.ts",
  "compatibility_date": "2026-01-30",
  "compatibility_flags": ["nodejs_compat"],

  // Route on workers.do enterprise zone (5GB cache support)
  "routes": [
    {
      "pattern": "parquedb.workers.do/*",
      "zone_name": "workers.do"
    }
  ],

  // =============================================================================
  // Durable Objects
  // =============================================================================

  "durable_objects": {
    "bindings": [
      {
        "name": "PARQUEDB",
        "class_name": "ParqueDBDO"
      }
    ]
  },

  // DO migrations - SQLite-backed Durable Objects
  "migrations": [
    {
      "tag": "v1",
      "new_sqlite_classes": ["ParqueDBDO"]
    }
  ],

  // =============================================================================
  // R2 Storage
  // =============================================================================

  "r2_buckets": [
    {
      "binding": "BUCKET",
      "bucket_name": "parquedb"
    },
    {
      "binding": "CDN_BUCKET",
      "bucket_name": "cdn"
    }
  ],

  // Note: Service bindings for self-reference are not supported in vitest-pool-workers
  // Use direct DO binding (PARQUEDB) for testing instead

  // =============================================================================
  // Environment Variables
  // =============================================================================

  "vars": {
    "ENVIRONMENT": "development",
    // CDN URL for R2 - r2.dev public URL (works, but no edge caching)
    // TODO: Switch to cdn.workers.do once API gateway is configured to pass through R2
    "CDN_R2_DEV_URL": "https://pub-259b9edb736e4f3b95672febc7981c49.r2.dev/parquedb"
  },

  // =============================================================================
  // Development Settings
  // =============================================================================

  "dev": {
    "port": 8787,
    "local_protocol": "http"
  },

  // =============================================================================
  // Build Configuration
  // =============================================================================

  "build": {
    "command": "npm run build",
    "watch_dir": "src"
  },

  // =============================================================================
  // Environment-specific overrides
  // =============================================================================

  "env": {
    "production": {
      "vars": {
        "ENVIRONMENT": "production"
      }
    },
    "staging": {
      "vars": {
        "ENVIRONMENT": "staging"
      }
    },
    "test": {
      "vars": {
        "ENVIRONMENT": "test",
        "LOG_LEVEL": "debug",
        "ENABLE_EVENT_SOURCING": "true",
        "ENABLE_TIME_TRAVEL": "true"
      },
      "durable_objects": {
        "bindings": [
          {
            "name": "PARQUEDB",
            "class_name": "ParqueDBDO"
          }
        ]
      },
      "r2_buckets": [
        {
          "binding": "BUCKET",
          "bucket_name": "parquedb-test"
        },
        {
          "binding": "CDN_BUCKET",
          "bucket_name": "parquedb-test"
        }
      ]
    }
  }
}
